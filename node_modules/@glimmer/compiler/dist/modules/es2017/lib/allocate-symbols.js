import { Stack } from '@glimmer/util';
export class SymbolAllocator {
    constructor(ops) {
        this.ops = ops;
        this.symbolStack = new Stack();
    }
    process() {
        let out = [];
        let { ops } = this;
        for (let i = 0; i < ops.length; i++) {
            let op = ops[i];
            let result = this.dispatch(op);
            if (result === undefined) {
                out.push(op);
            } else {
                out.push(result);
            }
        }
        return out;
    }
    dispatch(op) {
        let name = op[0];
        let operand = op[1];
        return this[name](operand);
    }
    get symbols() {
        return this.symbolStack.current;
    }
    startProgram(op) {
        this.symbolStack.push(op['symbols']);
    }
    endProgram(_op) {
        this.symbolStack.pop();
    }
    startBlock(op) {
        this.symbolStack.push(op['symbols']);
    }
    endBlock(_op) {
        this.symbolStack.pop();
    }
    flushElement(op) {
        this.symbolStack.push(op['symbols']);
    }
    closeElement(_op) {
        this.symbolStack.pop();
    }
    closeComponent(_op) {
        this.symbolStack.pop();
    }
    closeDynamicComponent(_op) {
        this.symbolStack.pop();
    }
    attrSplat(_op) {
        return ['attrSplat', this.symbols.allocateBlock('attrs')];
    }
    get(op) {
        let [name, rest] = op;
        if (name === 0) {
            return ['get', [0, rest]];
        }
        if (isLocal(name, this.symbols)) {
            let head = this.symbols.get(name);
            return ['get', [head, rest]];
        } else if (name[0] === '@') {
            let head = this.symbols.allocateNamed(name);
            return ['get', [head, rest]];
        } else {
            return ['maybeLocal', [name, ...rest]];
        }
    }
    maybeGet(op) {
        let [name, rest] = op;
        if (name === 0) {
            return ['get', [0, rest]];
        }
        if (isLocal(name, this.symbols)) {
            let head = this.symbols.get(name);
            return ['get', [head, rest]];
        } else if (name[0] === '@') {
            let head = this.symbols.allocateNamed(name);
            return ['get', [head, rest]];
        } else if (rest.length === 0) {
            return ['unknown', name];
        } else {
            return ['maybeLocal', [name, ...rest]];
        }
    }
    yield(op) {
        if (op === 0) {
            throw new Error('Cannot yield to this');
        }
        return ['yield', this.symbols.allocateBlock(op)];
    }
    debugger(_op) {
        return ['debugger', this.symbols.getEvalInfo()];
    }
    hasBlock(op) {
        if (op === 0) {
            throw new Error('Cannot hasBlock this');
        }
        return ['hasBlock', this.symbols.allocateBlock(op)];
    }
    hasBlockParams(op) {
        if (op === 0) {
            throw new Error('Cannot hasBlockParams this');
        }
        return ['hasBlockParams', this.symbols.allocateBlock(op)];
    }
    partial(_op) {
        return ['partial', this.symbols.getEvalInfo()];
    }
    text(_op) {}
    comment(_op) {}
    openComponent(_op) {}
    openElement(_op) {}
    openSplattedElement(_op) {}
    staticArg(_op) {}
    dynamicArg(_op) {}
    staticAttr(_op) {}
    trustingAttr(_op) {}
    trustingComponentAttr(_op) {}
    dynamicAttr(_op) {}
    componentAttr(_op) {}
    modifier(_op) {}
    append(_op) {}
    block(_op) {}
    literal(_op) {}
    helper(_op) {}
    unknown(_op) {}
    maybeLocal(_op) {}
    prepareArray(_op) {}
    prepareObject(_op) {}
    concat(_op) {}
}
function isLocal(name, symbols) {
    return symbols && symbols.has(name);
}
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiYWxsb2NhdGUtc3ltYm9scy5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbIi4uLy4uLy4uLy4uL3BhY2thZ2VzL0BnbGltbWVyL2NvbXBpbGVyL2xpYi9hbGxvY2F0ZS1zeW1ib2xzLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUdBLEFBQU8sU0FBRSxBQUFLLEFBQUUsQUFBTSxBQUFFLGFBQU0sQUFBZSxBQUFDO0FBaUI5QyxBQUFNLGFBQU8sQUFBZTtBQUkxQixnQkFBb0IsQUFBZ0I7QUFBaEIsYUFBRyxNQUFILEFBQUcsQUFBYTtBQUY1QixhQUFXLGNBQUcsSUFBSSxBQUFLLEFBQWUsQUFBQyxBQUVSO0FBQUM7QUFFeEMsQUFBTztBQUNMLFlBQUksQUFBRyxNQUFZLEFBQUUsQUFBQztBQUN0QixZQUFJLEVBQUUsQUFBRyxBQUFFLFFBQUcsQUFBSSxBQUFDO0FBRW5CLGFBQUssSUFBSSxBQUFDLElBQUcsQUFBQyxHQUFFLEFBQUMsSUFBRyxBQUFHLElBQUMsQUFBTSxRQUFFLEFBQUMsQUFBRSxLQUFFO0FBQ25DLGdCQUFJLEFBQUUsS0FBRyxBQUFHLElBQUMsQUFBQyxBQUFDLEFBQUM7QUFDaEIsZ0JBQUksQUFBTSxTQUFHLEFBQUksS0FBQyxBQUFRLFNBQUMsQUFBRSxBQUFDLEFBQUM7QUFFL0IsZ0JBQUksQUFBTSxXQUFLLEFBQVMsV0FBRTtBQUN4QixBQUFHLG9CQUFDLEFBQUksS0FBQyxBQUFXLEFBQUMsQUFBQztBQUN2QixtQkFBTTtBQUNMLEFBQUcsb0JBQUMsQUFBSSxLQUFDLEFBQWEsQUFBQyxBQUFDO0FBQ3pCO0FBQ0Y7QUFFRCxlQUFPLEFBQUcsQUFBQyxBQUNiO0FBQUM7QUFFRCxBQUFRLGFBQWlCLEFBQUs7QUFDNUIsWUFBSSxBQUFJLE9BQUcsQUFBRSxHQUFDLEFBQUMsQUFBQyxBQUFDO0FBQ2pCLFlBQUksQUFBTyxVQUFHLEFBQUUsR0FBQyxBQUFDLEFBQUMsQUFBQztBQUVwQixlQUFRLEFBQUksS0FBQyxBQUFJLEFBQVMs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NUIsQUFBWSxpQkFBQyxBQUFXLEtBQUcsQ0FBQztBQUM1QixBQUFhLGtCQUFDLEFBQVcsS0FBRyxDQUFDO0FBQzdCLEFBQU0sV0FBQyxBQUFTLEtBQUcsQ0FBQyxBQUNyQjs7QUFFRCxTQUFTLEFBQU8sUUFBQyxBQUFZLE1BQUUsQUFBb0I7QUFDakQsV0FBTyxBQUFPLFdBQUksQUFBTyxRQUFDLEFBQUcsSUFBQyxBQUFJLEFBQUMsQUFBQyxBQUN0QztBQUFDIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgQ29tcGlsZXJPcHMsIFByb2Nlc3NvciwgT3AsIE9wTmFtZSwgVGVtcGxhdGVDb21waWxlck9wcywgUGF0aEhlYWQgfSBmcm9tICcuL2NvbXBpbGVyLW9wcyc7XG5pbXBvcnQgeyBBU1QgfSBmcm9tICdAZ2xpbW1lci9zeW50YXgnO1xuaW1wb3J0IHsgT3B0aW9uLCBPcGFxdWUgfSBmcm9tICdAZ2xpbW1lci9pbnRlcmZhY2VzJztcbmltcG9ydCB7IFN0YWNrLCBleHBlY3QgfSBmcm9tICdAZ2xpbW1lci91dGlsJztcbmltcG9ydCB7IFN5bWJvbFRhYmxlIH0gZnJvbSAnLi90ZW1wbGF0ZS12aXNpdG9yJztcblxuZXhwb3J0IHR5cGUgSW5WYXJpYWJsZSA9IFBhdGhIZWFkO1xuZXhwb3J0IHR5cGUgT3V0VmFyaWFibGUgPSBudW1iZXI7XG5cbmV4cG9ydCB0eXBlIE91dE9wPEsgZXh0ZW5kcyBrZXlvZiBDb21waWxlck9wczxPdXRWYXJpYWJsZT4gPSBPcE5hbWU+ID0gT3A8XG4gIE91dFZhcmlhYmxlLFxuICBDb21waWxlck9wczxPdXRWYXJpYWJsZT4sXG4gIEtcbj47XG5leHBvcnQgdHlwZSBJbk9wPEsgZXh0ZW5kcyBrZXlvZiBUZW1wbGF0ZUNvbXBpbGVyT3BzID0ga2V5b2YgVGVtcGxhdGVDb21waWxlck9wcz4gPSBPcDxcbiAgUGF0aEhlYWQsXG4gIFRlbXBsYXRlQ29tcGlsZXJPcHMsXG4gIEtcbj47XG5cbmV4cG9ydCBjbGFzcyBTeW1ib2xBbGxvY2F0b3JcbiAgaW1wbGVtZW50cyBQcm9jZXNzb3I8Q29tcGlsZXJPcHM8SW5WYXJpYWJsZT4sIE91dFZhcmlhYmxlLCBDb21waWxlck9wczxPdXRWYXJpYWJsZT4+IHtcbiAgcHJpdmF0ZSBzeW1ib2xTdGFjayA9IG5ldyBTdGFjazxTeW1ib2xUYWJsZT4oKTtcblxuICBjb25zdHJ1Y3Rvcihwcml2YXRlIG9wczogQXJyYXk8SW5PcD4pIHt9XG5cbiAgcHJvY2VzcygpOiBPdXRPcFtdIHtcbiAgICBsZXQgb3V0OiBPdXRPcFtdID0gW107XG4gICAgbGV0IHsgb3BzIH0gPSB0aGlzO1xuXG4gICAgZm9yIChsZXQgaSA9IDA7IGkgPCBvcHMubGVuZ3RoOyBpKyspIHtcbiAgICAgIGxldCBvcCA9IG9wc1tpXTtcbiAgICAgIGxldCByZXN1bHQgPSB0aGlzLmRpc3BhdGNoKG9wKTtcblxuICAgICAgaWYgKHJlc3VsdCA9PT0gdW5kZWZpbmVkKSB7XG4gICAgICAgIG91dC5wdXNoKG9wIGFzIE91dE9wKTtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIG91dC5wdXNoKHJlc3VsdCBhcyBhbnkpO1xuICAgICAgfVxuICAgIH1cblxuICAgIHJldHVybiBvdXQ7XG4gIH1cblxuICBkaXNwYXRjaDxPIGV4dGVuZHMgSW5PcD4ob3A6IE8pOiBPcGFxdWUge1xuICAgIGxldCBuYW1lID0gb3BbMF07XG4gICAgbGV0IG9wZXJhbmQgPSBvcFsxXTtcblxuICAgIHJldHVybiAodGhpc1tuYW1lXSBhcyBhbnkpKG9wZXJhbmQpO1xuICB9XG5cbiAgZ2V0IHN5bWJvbHMoKTogU3ltYm9sVGFibGUge1xuICAgIHJldHVybiBleHBlY3QodGhpcy5zeW1ib2xTdGFjay5jdXJyZW50LCAnRXhwZWN0ZWQgYSBzeW1ib2wgdGFibGUgb24gdGhlIHN0YWNrJyk7XG4gIH1cblxuICBzdGFydFByb2dyYW0ob3A6IEFTVC5Qcm9ncmFtKSB7XG4gICAgdGhpcy5zeW1ib2xTdGFjay5wdXNoKG9wWydzeW1ib2xzJ10pO1xuICB9XG5cbiAgZW5kUHJvZ3JhbShfb3A6IG51bGwpIHtcbiAgICB0aGlzLnN5bWJvbFN0YWNrLnBvcCgpO1xuICB9XG5cbiAgc3RhcnRCbG9jayhvcDogQVNULlByb2dyYW0pIHtcbiAgICB0aGlzLnN5bWJvbFN0YWNrLnB1c2gob3BbJ3N5bWJvbHMnXSk7XG4gIH1cblxuICBlbmRCbG9jayhfb3A6IG51bGwpIHtcbiAgICB0aGlzLnN5bWJvbFN0YWNrLnBvcCgpO1xuICB9XG5cbiAgZmx1c2hFbGVtZW50KG9wOiBBU1QuRWxlbWVudE5vZGUpIHtcbiAgICB0aGlzLnN5bWJvbFN0YWNrLnB1c2gob3BbJ3N5bWJvbHMnXSk7XG4gIH1cblxuICBjbG9zZUVsZW1lbnQoX29wOiBBU1QuRWxlbWVudE5vZGUpIHtcbiAgICB0aGlzLnN5bWJvbFN0YWNrLnBvcCgpO1xuICB9XG5cbiAgY2xvc2VDb21wb25lbnQoX29wOiBBU1QuRWxlbWVudE5vZGUpIHtcbiAgICB0aGlzLnN5bWJvbFN0YWNrLnBvcCgpO1xuICB9XG5cbiAgY2xvc2VEeW5hbWljQ29tcG9uZW50KF9vcDogQVNULkVsZW1lbnROb2RlKSB7XG4gICAgdGhpcy5zeW1ib2xTdGFjay5wb3AoKTtcbiAgfVxuXG4gIGF0dHJTcGxhdChfb3A6IE9wdGlvbjxJblZhcmlhYmxlPik6IE91dE9wPCdhdHRyU3BsYXQnPiB7XG4gICAgcmV0dXJuIFsnYXR0clNwbGF0JywgdGhpcy5zeW1ib2xzLmFsbG9jYXRlQmxvY2soJ2F0dHJzJyldO1xuICB9XG5cbiAgZ2V0KG9wOiBbSW5WYXJpYWJsZSwgc3RyaW5nW11dKTogT3V0T3A8J2dldCcgfCAnbWF5YmVMb2NhbCc+IHtcbiAgICBsZXQgW25hbWUsIHJlc3RdID0gb3A7XG5cbiAgICBpZiAobmFtZSA9PT0gMCkge1xuICAgICAgcmV0dXJuIFsnZ2V0JywgWzAsIHJlc3RdXTtcbiAgICB9XG5cbiAgICBpZiAoaXNMb2NhbChuYW1lLCB0aGlzLnN5bWJvbHMpKSB7XG4gICAgICBsZXQgaGVhZCA9IHRoaXMuc3ltYm9scy5nZXQobmFtZSk7XG4gICAgICByZXR1cm4gWydnZXQnLCBbaGVhZCwgcmVzdF1dO1xuICAgIH0gZWxzZSBpZiAobmFtZVswXSA9PT0gJ0AnKSB7XG4gICAgICBsZXQgaGVhZCA9IHRoaXMuc3ltYm9scy5hbGxvY2F0ZU5hbWVkKG5hbWUpO1xuICAgICAgcmV0dXJuIFsnZ2V0JywgW2hlYWQsIHJlc3RdXTtcbiAgICB9IGVsc2Uge1xuICAgICAgcmV0dXJuIFsnbWF5YmVMb2NhbCcsIFtuYW1lLCAuLi5yZXN0XV07XG4gICAgfVxuICB9XG5cbiAgbWF5YmVHZXQob3A6IFtJblZhcmlhYmxlLCBzdHJpbmdbXV0pOiBPdXRPcDwnZ2V0JyB8ICd1bmtub3duJyB8ICdtYXliZUxvY2FsJz4ge1xuICAgIGxldCBbbmFtZSwgcmVzdF0gPSBvcDtcblxuICAgIGlmIChuYW1lID09PSAwKSB7XG4gICAgICByZXR1cm4gWydnZXQnLCBbMCwgcmVzdF1dO1xuICAgIH1cblxuICAgIGlmIChpc0xvY2FsKG5hbWUsIHRoaXMuc3ltYm9scykpIHtcbiAgICAgIGxldCBoZWFkID0gdGhpcy5zeW1ib2xzLmdldChuYW1lKTtcbiAgICAgIHJldHVybiBbJ2dldCcsIFtoZWFkLCByZXN0XV07XG4gICAgfSBlbHNlIGlmIChuYW1lWzBdID09PSAnQCcpIHtcbiAgICAgIGxldCBoZWFkID0gdGhpcy5zeW1ib2xzLmFsbG9jYXRlTmFtZWQobmFtZSk7XG4gICAgICByZXR1cm4gWydnZXQnLCBbaGVhZCwgcmVzdF1dO1xuICAgIH0gZWxzZSBpZiAocmVzdC5sZW5ndGggPT09IDApIHtcbiAgICAgIHJldHVybiBbJ3Vua25vd24nLCBuYW1lXTtcbiAgICB9IGVsc2Uge1xuICAgICAgcmV0dXJuIFsnbWF5YmVMb2NhbCcsIFtuYW1lLCAuLi5yZXN0XV07XG4gICAgfVxuICB9XG5cbiAgeWllbGQob3A6IEluVmFyaWFibGUpOiBPdXRPcDwneWllbGQnPiB7XG4gICAgaWYgKG9wID09PSAwKSB7XG4gICAgICB0aHJvdyBuZXcgRXJyb3IoJ0Nhbm5vdCB5aWVsZCB0byB0aGlzJyk7XG4gICAgfVxuXG4gICAgcmV0dXJuIFsneWllbGQnLCB0aGlzLnN5bWJvbHMuYWxsb2NhdGVCbG9jayhvcCldO1xuICB9XG5cbiAgZGVidWdnZXIoX29wOiBPcHRpb248SW5WYXJpYWJsZVtdPik6IE91dE9wPCdkZWJ1Z2dlcic+IHtcbiAgICByZXR1cm4gWydkZWJ1Z2dlcicsIHRoaXMuc3ltYm9scy5nZXRFdmFsSW5mbygpXTtcbiAgfVxuXG4gIGhhc0Jsb2NrKG9wOiBJblZhcmlhYmxlKTogT3V0T3A8J2hhc0Jsb2NrJz4ge1xuICAgIGlmIChvcCA9PT0gMCkge1xuICAgICAgdGhyb3cgbmV3IEVycm9yKCdDYW5ub3QgaGFzQmxvY2sgdGhpcycpO1xuICAgIH1cblxuICAgIHJldHVybiBbJ2hhc0Jsb2NrJywgdGhpcy5zeW1ib2xzLmFsbG9jYXRlQmxvY2sob3ApXTtcbiAgfVxuXG4gIGhhc0Jsb2NrUGFyYW1zKG9wOiBJblZhcmlhYmxlKTogT3V0T3A8J2hhc0Jsb2NrUGFyYW1zJz4ge1xuICAgIGlmIChvcCA9PT0gMCkge1xuICAgICAgdGhyb3cgbmV3IEVycm9yKCdDYW5ub3QgaGFzQmxvY2tQYXJhbXMgdGhpcycpO1xuICAgIH1cblxuICAgIHJldHVybiBbJ2hhc0Jsb2NrUGFyYW1zJywgdGhpcy5zeW1ib2xzLmFsbG9jYXRlQmxvY2sob3ApXTtcbiAgfVxuXG4gIHBhcnRpYWwoX29wOiBPcHRpb248SW5WYXJpYWJsZVtdPik6IE91dE9wPCdwYXJ0aWFsJz4ge1xuICAgIHJldHVybiBbJ3BhcnRpYWwnLCB0aGlzLnN5bWJvbHMuZ2V0RXZhbEluZm8oKV07XG4gIH1cblxuICB0ZXh0KF9vcDogc3RyaW5nKSB7fVxuICBjb21tZW50KF9vcDogc3RyaW5nKSB7fVxuICBvcGVuQ29tcG9uZW50KF9vcDogQVNULkVsZW1lbnROb2RlKSB7fVxuICBvcGVuRWxlbWVudChfb3A6IEFTVC5FbGVtZW50Tm9kZSkge31cbiAgb3BlblNwbGF0dGVkRWxlbWVudChfb3A6IEFTVC5FbGVtZW50Tm9kZSkge31cbiAgc3RhdGljQXJnKF9vcDogc3RyaW5nKSB7fVxuICBkeW5hbWljQXJnKF9vcDogc3RyaW5nKSB7fVxuICBzdGF0aWNBdHRyKF9vcDogW3N0cmluZywgT3B0aW9uPHN0cmluZz5dKSB7fVxuICB0cnVzdGluZ0F0dHIoX29wOiBbc3RyaW5nLCBPcHRpb248c3RyaW5nPl0pIHt9XG4gIHRydXN0aW5nQ29tcG9uZW50QXR0cihfb3A6IFtzdHJpbmcsIE9wdGlvbjxzdHJpbmc+XSkge31cbiAgZHluYW1pY0F0dHIoX29wOiBbc3RyaW5nLCBPcHRpb248c3RyaW5nPl0pIHt9XG4gIGNvbXBvbmVudEF0dHIoX29wOiBbc3RyaW5nLCBPcHRpb248c3RyaW5nPl0pIHt9XG4gIG1vZGlmaWVyKF9vcDogc3RyaW5nKSB7fVxuICBhcHBlbmQoX29wOiBib29sZWFuKSB7fVxuICBibG9jayhfb3A6IFtzdHJpbmcsIG51bWJlciwgT3B0aW9uPG51bWJlcj5dKSB7fVxuICBsaXRlcmFsKF9vcDogc3RyaW5nIHwgYm9vbGVhbiB8IG51bWJlciB8IG51bGwgfCB1bmRlZmluZWQpIHt9XG4gIGhlbHBlcihfb3A6IHN0cmluZykge31cbiAgdW5rbm93bihfb3A6IHN0cmluZykge31cbiAgbWF5YmVMb2NhbChfb3A6IHN0cmluZ1tdKSB7fVxuICBwcmVwYXJlQXJyYXkoX29wOiBudW1iZXIpIHt9XG4gIHByZXBhcmVPYmplY3QoX29wOiBudW1iZXIpIHt9XG4gIGNvbmNhdChfb3A6IG51bGwpIHt9XG59XG5cbmZ1bmN0aW9uIGlzTG9jYWwobmFtZTogc3RyaW5nLCBzeW1ib2xzOiBTeW1ib2xUYWJsZSk6IGJvb2xlYW4ge1xuICByZXR1cm4gc3ltYm9scyAmJiBzeW1ib2xzLmhhcyhuYW1lKTtcbn1cbiJdfQ==