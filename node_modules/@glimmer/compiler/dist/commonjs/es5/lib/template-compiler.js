'use strict';

Object.defineProperty(exports, "__esModule", {
    value: true
});
exports.THIS = undefined;

var _templateVisitor = require('./template-visitor');

var _templateVisitor2 = _interopRequireDefault(_templateVisitor);

var _javascriptCompiler = require('./javascript-compiler');

var _javascriptCompiler2 = _interopRequireDefault(_javascriptCompiler);

var _util = require('@glimmer/util');

var _syntax = require('@glimmer/syntax');

var _utils = require('./utils');

var _allocateSymbols = require('./allocate-symbols');

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

function _classCallCheck(instance, Constructor) {
    if (!(instance instanceof Constructor)) {
        throw new TypeError("Cannot call a class as a function");
    }
}

function isTrustedValue(value) {
    return value.escaped !== undefined && !value.escaped;
}
var THIS = exports.THIS = 0;

var TemplateCompiler = function () {
    function TemplateCompiler() {
        _classCallCheck(this, TemplateCompiler);

        this.templateId = 0;
        this.templateIds = [];
        this.opcodes = [];
        this.includeMeta = false;
    }

    TemplateCompiler.compile = function compile(ast, options) {
        var templateVisitor = new _templateVisitor2.default();
        templateVisitor.visit(ast);
        var compiler = new TemplateCompiler();
        var opcodes = compiler.process(templateVisitor.actions);
        var symbols = new _allocateSymbols.SymbolAllocator(opcodes).process();
        return _javascriptCompiler2.default.process(symbols, ast['symbols'], options);
    };

    TemplateCompiler.prototype.process = function process(actions) {
        var _this = this;

        actions.forEach(function (_ref) {
            var name = _ref[0],
                args = _ref.slice(1);

            if (!_this[name]) {
                throw new Error('Unimplemented ' + name + ' on TemplateCompiler');
            }
            _this[name].apply(_this, args);
        });
        return this.opcodes;
    };

    TemplateCompiler.prototype.startProgram = function startProgram(_ref2) {
        var program = _ref2[0];

        this.opcode(['startProgram', program], program);
    };

    TemplateCompiler.prototype.endProgram = function endProgram() {
        this.opcode(['endProgram', null], null);
    };

    TemplateCompiler.prototype.startBlock = function startBlock(_ref3) {
        var program = _ref3[0];

        this.templateId++;
        this.opcode(['startBlock', program], program);
    };

    TemplateCompiler.prototype.endBlock = function endBlock() {
        this.templateIds.push(this.templateId - 1);
        this.opcode(['endBlock', null], null);
    };

    TemplateCompiler.prototype.text = function text(_ref4) {
        var action = _ref4[0];

        this.opcode(['text', action.chars], action);
    };

    TemplateCompiler.prototype.comment = function comment(_ref5) {
        var action = _ref5[0];

        this.opcode(['comment', action.value], action);
    };

    TemplateCompiler.prototype.openElement = function openElement(_ref6) {
        var action = _ref6[0];

        var attributes = action.attributes;
        var hasSplat = false;
        for (var i = 0; i < attributes.length; i++) {
            var attr = attributes[i];
            if (attr.name === '...attributes') {
                hasSplat = true;
                break;
            }
        }
        var actionIsComponent = false;
        if (isDynamicComponent(action)) {
            var head = void 0,
                rest = void 0;

            var _action$tag$split = action.tag.split('.');

            head = _action$tag$split[0];
            rest = _action$tag$split.slice(1);

            if (head === 'this') {
                head = 0;
            }
            this.opcode(['get', [head, rest]]);
            this.opcode(['openComponent', action], action);
            actionIsComponent = true;
        } else if (isComponent(action)) {
            this.opcode(['openComponent', action], action);
            actionIsComponent = true;
        } else if (hasSplat) {
            this.opcode(['openSplattedElement', action], action);
        } else {
            this.opcode(['openElement', action], action);
        }
        var typeAttr = null;
        var attrs = action.attributes;
        for (var _i = 0; _i < attrs.length; _i++) {
            if (attrs[_i].name === 'type') {
                typeAttr = attrs[_i];
                continue;
            }
            this.attribute([attrs[_i]], hasSplat || actionIsComponent);
        }
        if (typeAttr) {
            this.attribute([typeAttr], hasSplat || actionIsComponent);
        }
        this.opcode(['flushElement', action], null);
    };

    TemplateCompiler.prototype.closeElement = function closeElement(_ref7) {
        var action = _ref7[0];

        if (isDynamicComponent(action)) {
            this.opcode(['closeDynamicComponent', action], action);
        } else if (isComponent(action)) {
            this.opcode(['closeComponent', action], action);
        } else if (action.modifiers.length > 0) {
            for (var i = 0; i < action.modifiers.length; i++) {
                this.modifier([action.modifiers[i]]);
            }
            this.opcode(['closeElement', action], action);
        } else {
            this.opcode(['closeElement', action], action);
        }
    };

    TemplateCompiler.prototype.attribute = function attribute(_ref8, isComponent) {
        var action = _ref8[0];
        var name = action.name,
            value = action.value;

        var namespace = (0, _utils.getAttrNamespace)(name);
        var isStatic = this.prepareAttributeValue(value);
        if (name.charAt(0) === '@') {
            // Arguments
            if (isStatic) {
                this.opcode(['staticArg', name], action);
            } else if (action.value.type === 'MustacheStatement') {
                this.opcode(['dynamicArg', name], action);
            } else {
                this.opcode(['dynamicArg', name], action);
            }
        } else {
            var isTrusting = isTrustedValue(value);
            if (isStatic && name === '...attributes') {
                this.opcode(['attrSplat', null], action);
            } else if (isStatic && !isComponent) {
                this.opcode(['staticAttr', [name, namespace]], action);
            } else if (isTrusting) {
                this.opcode([isComponent ? 'trustingComponentAttr' : 'trustingAttr', [name, namespace]], action);
            } else if (action.value.type === 'MustacheStatement') {
                this.opcode([isComponent ? 'componentAttr' : 'dynamicAttr', [name, null]], action);
            } else {
                this.opcode([isComponent ? 'componentAttr' : 'dynamicAttr', [name, namespace]], action);
            }
        }
    };

    TemplateCompiler.prototype.modifier = function modifier(_ref9) {
        var action = _ref9[0];

        assertIsSimplePath(action.path, action.loc, 'modifier');
        var parts = action.path.parts;

        this.prepareHelper(action);
        this.opcode(['modifier', parts[0]], action);
    };

    TemplateCompiler.prototype.mustache = function mustache(_ref10) {
        var action = _ref10[0];
        var path = action.path;

        if ((0, _syntax.isLiteral)(path)) {
            this.mustacheExpression(action);
            this.opcode(['append', !action.escaped], action);
        } else if (isYield(path)) {
            var to = assertValidYield(action);
            this.yield(to, action);
        } else if (isPartial(path)) {
            var params = assertValidPartial(action);
            this.partial(params, action);
        } else if (isDebugger(path)) {
            assertValidDebuggerUsage(action);
            this.debugger('debugger', action);
        } else {
            this.mustacheExpression(action);
            this.opcode(['append', !action.escaped], action);
        }
    };

    TemplateCompiler.prototype.block = function block(_ref11) {
        var action /*, index, count*/ = _ref11[0];

        this.prepareHelper(action);
        var templateId = this.templateIds.pop();
        var inverseId = action.inverse === null ? null : this.templateIds.pop();
        this.opcode(['block', [action.path.parts[0], templateId, inverseId]], action);
    };
    /// Internal actions, not found in the original processed actions


    TemplateCompiler.prototype.arg = function arg(_ref12) {
        var path = _ref12[0];

        var _path$parts = path.parts,
            head = _path$parts[0],
            rest = _path$parts.slice(1);

        this.opcode(['get', ['@' + head, rest]], path);
    };

    TemplateCompiler.prototype.mustacheExpression = function mustacheExpression(expr) {
        var path = expr.path;

        if ((0, _syntax.isLiteral)(path)) {
            this.opcode(['literal', path.value], expr);
        } else if (isBuiltInHelper(path)) {
            this.builtInHelper(expr);
        } else if (isArg(path)) {
            this.arg([path]);
        } else if (isHelperInvocation(expr)) {
            this.prepareHelper(expr);
            this.opcode(['helper', path.parts[0]], expr);
        } else if (path.this) {
            this.opcode(['get', [0, path.parts]], expr);
        } else {
            var _path$parts2 = path.parts,
                head = _path$parts2[0],
                parts = _path$parts2.slice(1);

            this.opcode(['maybeGet', [head, parts]], expr);
        }
        // } else if (isLocal(path, this.symbols)) {
        //   let [head, ...parts] = path.parts;
        //   this.opcode(['get', [head, parts]], expr);
        // } else if (isSimplePath(path)) {
        //   this.opcode(['unknown', path.parts[0]], expr);
        // } else {
        //   this.opcode(['maybeLocal', path.parts], expr);
        // }
    };
    /// Internal Syntax


    TemplateCompiler.prototype.yield = function _yield(to, action) {
        this.prepareParams(action.params);
        this.opcode(['yield', to], action);
    };

    TemplateCompiler.prototype.debugger = function _debugger(_name, action) {
        this.opcode(['debugger', null], action);
    };

    TemplateCompiler.prototype.hasBlock = function hasBlock(name, action) {
        this.opcode(['hasBlock', name], action);
    };

    TemplateCompiler.prototype.hasBlockParams = function hasBlockParams(name, action) {
        this.opcode(['hasBlockParams', name], action);
    };

    TemplateCompiler.prototype.partial = function partial(_params, action) {
        this.prepareParams(action.params);
        this.opcode(['partial', null], action);
    };

    TemplateCompiler.prototype.builtInHelper = function builtInHelper(expr) {
        var path = expr.path;

        if (isHasBlock(path)) {
            var name = assertValidHasBlockUsage(expr.path.original, expr);
            this.hasBlock(name, expr);
        } else if (isHasBlockParams(path)) {
            var _name2 = assertValidHasBlockUsage(expr.path.original, expr);
            this.hasBlockParams(_name2, expr);
        }
    };
    /// Expressions, invoked recursively from prepareParams and prepareHash


    TemplateCompiler.prototype.SubExpression = function SubExpression(expr) {
        if (isBuiltInHelper(expr.path)) {
            this.builtInHelper(expr);
        } else {
            this.prepareHelper(expr);
            this.opcode(['helper', expr.path.parts[0]], expr);
        }
    };

    TemplateCompiler.prototype.PathExpression = function PathExpression(expr) {
        if (expr.data) {
            this.arg([expr]);
        } else {
            var _expr$parts = expr.parts,
                head = _expr$parts[0],
                rest = _expr$parts.slice(1);

            if (expr.this) {
                this.opcode(['get', [0, expr.parts]], expr);
            } else {
                this.opcode(['get', [head, rest]], expr);
            }
        }
    };

    TemplateCompiler.prototype.StringLiteral = function StringLiteral(action) {
        this.opcode(['literal', action.value], action);
    };

    TemplateCompiler.prototype.BooleanLiteral = function BooleanLiteral(action) {
        this.opcode(['literal', action.value], action);
    };

    TemplateCompiler.prototype.NumberLiteral = function NumberLiteral(action) {
        this.opcode(['literal', action.value], action);
    };

    TemplateCompiler.prototype.NullLiteral = function NullLiteral(action) {
        this.opcode(['literal', action.value], action);
    };

    TemplateCompiler.prototype.UndefinedLiteral = function UndefinedLiteral(action) {
        this.opcode(['literal', action.value], action);
    };
    /// Utilities


    TemplateCompiler.prototype.opcode = function opcode(_opcode) {
        var action = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : null;

        // TODO: This doesn't really work
        if (this.includeMeta && action) {
            _opcode.push(this.meta(action));
        }
        this.opcodes.push(_opcode);
    };

    TemplateCompiler.prototype.prepareHelper = function prepareHelper(expr) {
        assertIsSimplePath(expr.path, expr.loc, 'helper');
        var params = expr.params,
            hash = expr.hash;

        this.prepareHash(hash);
        this.prepareParams(params);
    };

    TemplateCompiler.prototype.prepareParams = function prepareParams(params) {
        if (!params.length) {
            this.opcode(['literal', null], null);
            return;
        }
        for (var i = params.length - 1; i >= 0; i--) {
            var param = params[i];
            false && (0, _util.assert)(this[param.type], 'Unimplemented ' + param.type + ' on TemplateCompiler');

            this[param.type](param);
        }
        this.opcode(['prepareArray', params.length], null);
    };

    TemplateCompiler.prototype.prepareHash = function prepareHash(hash) {
        var pairs = hash.pairs;
        if (!pairs.length) {
            this.opcode(['literal', null], null);
            return;
        }
        for (var i = pairs.length - 1; i >= 0; i--) {
            var _pairs$i = pairs[i],
                key = _pairs$i.key,
                value = _pairs$i.value;

            false && (0, _util.assert)(this[value.type], 'Unimplemented ' + value.type + ' on TemplateCompiler');

            this[value.type](value);
            this.opcode(['literal', key], null);
        }
        this.opcode(['prepareObject', pairs.length], null);
    };

    TemplateCompiler.prototype.prepareAttributeValue = function prepareAttributeValue(value) {
        // returns the static value if the value is static
        switch (value.type) {
            case 'TextNode':
                this.opcode(['literal', value.chars], value);
                return true;
            case 'MustacheStatement':
                this.attributeMustache([value]);
                return false;
            case 'ConcatStatement':
                this.prepareConcatParts(value.parts);
                this.opcode(['concat', null], value);
                return false;
        }
    };

    TemplateCompiler.prototype.prepareConcatParts = function prepareConcatParts(parts) {
        for (var i = parts.length - 1; i >= 0; i--) {
            var part = parts[i];
            if (part.type === 'MustacheStatement') {
                this.attributeMustache([part]);
            } else if (part.type === 'TextNode') {
                this.opcode(['literal', part.chars], null);
            }
        }
        this.opcode(['prepareArray', parts.length], null);
    };

    TemplateCompiler.prototype.attributeMustache = function attributeMustache(_ref13) {
        var action = _ref13[0];

        this.mustacheExpression(action);
    };

    TemplateCompiler.prototype.meta = function meta(node) {
        var loc = node.loc;
        if (!loc) {
            return [];
        }
        var source = loc.source,
            start = loc.start,
            end = loc.end;

        return ['loc', [source || null, [start.line, start.column], [end.line, end.column]]];
    };

    return TemplateCompiler;
}();

exports.default = TemplateCompiler;


function isHelperInvocation(mustache) {
    return mustache.params && mustache.params.length > 0 || mustache.hash && mustache.hash.pairs.length > 0;
}
function isSimplePath(_ref14) {
    var parts = _ref14.parts;

    return parts.length === 1;
}
function isYield(path) {
    return path.original === 'yield';
}
function isPartial(path) {
    return path.original === 'partial';
}
function isDebugger(path) {
    return path.original === 'debugger';
}
function isHasBlock(path) {
    return path.original === 'has-block';
}
function isHasBlockParams(path) {
    return path.original === 'has-block-params';
}
function isBuiltInHelper(path) {
    return isHasBlock(path) || isHasBlockParams(path);
}
function isArg(path) {
    return !!path['data'];
}
function isDynamicComponent(element) {
    var open = element.tag.charAt(0);

    var _element$tag$split = element.tag.split('.'),
        maybeLocal = _element$tag$split[0];

    var isNamedArgument = open === '@';
    var isLocal = element['symbols'].has(maybeLocal);
    var isThisPath = element.tag.indexOf('this.') === 0;
    return isLocal || isNamedArgument || isThisPath;
}
function isComponent(element) {
    var open = element.tag.charAt(0);
    var isPath = element.tag.indexOf('.') > -1;
    var isUpperCase = open === open.toUpperCase() && open !== open.toLowerCase();
    return isUpperCase && !isPath || isDynamicComponent(element);
}
function assertIsSimplePath(path, loc, context) {
    if (!isSimplePath(path)) {
        throw new _syntax.SyntaxError('`' + path.original + '` is not a valid name for a ' + context + ' on line ' + loc.start.line + '.', path.loc);
    }
}
function assertValidYield(statement) {
    var pairs = statement.hash.pairs;

    if (pairs.length === 1 && pairs[0].key !== 'to' || pairs.length > 1) {
        throw new _syntax.SyntaxError('yield only takes a single named argument: \'to\'', statement.loc);
    } else if (pairs.length === 1 && pairs[0].value.type !== 'StringLiteral') {
        throw new _syntax.SyntaxError('you can only yield to a literal value', statement.loc);
    } else if (pairs.length === 0) {
        return 'default';
    } else {
        return pairs[0].value.value;
    }
}
function assertValidPartial(statement) {
    var params = statement.params,
        hash = statement.hash,
        escaped = statement.escaped,
        loc = statement.loc;

    if (params && params.length !== 1) {
        throw new _syntax.SyntaxError('Partial found with no arguments. You must specify a template name. (on line ' + loc.start.line + ')', statement.loc);
    } else if (hash && hash.pairs.length > 0) {
        throw new _syntax.SyntaxError('partial does not take any named arguments (on line ' + loc.start.line + ')', statement.loc);
    } else if (!escaped) {
        throw new _syntax.SyntaxError('{{{partial ...}}} is not supported, please use {{partial ...}} instead (on line ' + loc.start.line + ')', statement.loc);
    }
    return params;
}
function assertValidHasBlockUsage(type, call) {
    var params = call.params,
        hash = call.hash,
        loc = call.loc;

    if (hash && hash.pairs.length > 0) {
        throw new _syntax.SyntaxError(type + ' does not take any named arguments', call.loc);
    }
    if (params.length === 0) {
        return 'default';
    } else if (params.length === 1) {
        var param = params[0];
        if (param.type === 'StringLiteral') {
            return param.value;
        } else {
            throw new _syntax.SyntaxError('you can only yield to a literal value (on line ' + loc.start.line + ')', call.loc);
        }
    } else {
        throw new _syntax.SyntaxError(type + ' only takes a single positional argument (on line ' + loc.start.line + ')', call.loc);
    }
}
function assertValidDebuggerUsage(statement) {
    var params = statement.params,
        hash = statement.hash;

    if (hash && hash.pairs.length > 0) {
        throw new _syntax.SyntaxError('debugger does not take any named arguments', statement.loc);
    }
    if (params.length === 0) {
        return 'default';
    } else {
        throw new _syntax.SyntaxError('debugger does not take any positional arguments', statement.loc);
    }
}
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoidGVtcGxhdGUtY29tcGlsZXIuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyIuLi8uLi8uLi8uLi9wYWNrYWdlcy9AZ2xpbW1lci9jb21waWxlci9saWIvdGVtcGxhdGUtY29tcGlsZXIudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7Ozs7OztBQUFBLEFBQU8sQUFBMkIsQUFBTSxBQUFvQixBQUFDOzs7O0FBQzdELEFBQU8sQUFBZ0MsQUFBTSxBQUF1QixBQUFDOzs7O0FBQ3JFLEFBQU8sQUFBRSxBQUFNLEFBQVUsQUFBTSxBQUFlLEFBQUM7O0FBQy9DLEFBQU8sQUFBTyxBQUFTLEFBQUUsQUFBVyxBQUFFLEFBQU0sQUFBaUIsQUFBQzs7QUFDOUQsQUFBTyxBQUFFLEFBQWdCLEFBQUUsQUFBTSxBQUFTLEFBQUM7O0FBRTNDLEFBQU8sQUFBRSxBQUFlLEFBQTRDLEFBQU0sQUFBb0IsQUFBQzs7Ozs7Ozs7OztBQVEvRixTQUFTLEFBQWMsZUFBQyxBQUFVLE9BQ2hDO1dBQU8sQUFBSyxNQUFDLEFBQU8sWUFBSyxBQUFTLGFBQUksQ0FBQyxBQUFLLE1BQUMsQUFBTyxBQUFDLEFBQ3ZELEFBQUM7QUFFRCxBQUFNO0FBQUMsSUFBTSxBQUFJLHNCQUFHLEFBQUMsQUFBQyxBQUV0QixBQUFNLEFBQUMsQUFBTzs7SUFBZCxBQUFxQixBQUFnQjtnQ0FZM0I7OzthQUFVLGFBQUcsQUFBQyxBQUFDLEFBQ2Y7YUFBVyxjQUFhLEFBQUUsQUFBQyxBQUMzQjthQUFPLFVBQWlCLEFBQUUsQUFBQyxBQUMzQjthQUFXLGNBQUcsQUFBSyxBQUFDLEFBeVk5QixBQUFDLEFBdlpDLEFBQU07OztxQkFBQyxBQUFPLDJCQUFDLEFBQWdCLEtBQUUsQUFBd0IsU0FDdkQ7WUFBSSxBQUFlLGtCQUFHLEFBQUksQUFBZSxBQUFFLEFBQUMsQUFDNUMsQUFBZTt3QkFBQyxBQUFLLE1BQUMsQUFBRyxBQUFDLEFBQUMsQUFFM0I7WUFBSSxBQUFRLFdBQUcsSUFBSSxBQUFnQixBQUFFLEFB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SCxBQUNILEFBQUM7OztBQUVELFNBQVMsQUFBd0IseUJBQUMsQUFBZ0MsV0FDaEUsQUFBSTtRQUFFLEFBQU07UUFBRSxBQUFJLEFBQUUsT0FBRyxBQUFTLEFBQUMsQUFFakM7O1FBQUksQUFBSSxRQUFJLEFBQUksS0FBQyxBQUFLLE1BQUMsQUFBTSxTQUFHLEFBQUMsR0FBRSxBQUNqQztjQUFNLEFBQUksQUFBVyxBQUFDLEFBQTRDLHNFQUFFLEFBQVMsVUFBQyxBQUFHLEFBQUMsQUFBQyxBQUNwRixBQUVEOztRQUFJLEFBQU0sT0FBQyxBQUFNLFdBQUssQUFBQyxHQUFFLEFBQ3ZCO2VBQU8sQUFBUyxBQUFDLEFBQ2xCO1dBQU0sQUFDTDtjQUFNLEFBQUksQUFBVyxBQUFDLEFBQWlELDJFQUFFLEFBQVMsVUFBQyxBQUFHLEFBQUMsQUFBQyxBQUN6RixBQUNILEFBQUMiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgVGVtcGxhdGVWaXNpdG9yLCB7IEFjdGlvbiB9IGZyb20gJy4vdGVtcGxhdGUtdmlzaXRvcic7XG5pbXBvcnQgSmF2YVNjcmlwdENvbXBpbGVyLCB7IFRlbXBsYXRlIH0gZnJvbSAnLi9qYXZhc2NyaXB0LWNvbXBpbGVyJztcbmltcG9ydCB7IGFzc2VydCwgT3B0aW9uIH0gZnJvbSAnQGdsaW1tZXIvdXRpbCc7XG5pbXBvcnQgeyBBU1QsIGlzTGl0ZXJhbCwgU3ludGF4RXJyb3IgfSBmcm9tICdAZ2xpbW1lci9zeW50YXgnO1xuaW1wb3J0IHsgZ2V0QXR0ck5hbWVzcGFjZSB9IGZyb20gJy4vdXRpbHMnO1xuaW1wb3J0IHsgT3BhcXVlIH0gZnJvbSAnQGdsaW1tZXIvaW50ZXJmYWNlcyc7XG5pbXBvcnQgeyBTeW1ib2xBbGxvY2F0b3IsIEluT3AgYXMgU3ltYm9sSW5PcCwgT3V0T3AgYXMgU3ltYm9sT3V0T3AgfSBmcm9tICcuL2FsbG9jYXRlLXN5bWJvbHMnO1xuaW1wb3J0IHsgUGF0aEhlYWQgfSBmcm9tICcuL2NvbXBpbGVyLW9wcyc7XG5cbmV4cG9ydCBpbnRlcmZhY2UgQ29tcGlsZU9wdGlvbnMge1xuICBtZXRhOiBPcGFxdWU7XG4gIGN1c3RvbWl6ZUNvbXBvbmVudE5hbWU/KHRhZzogc3RyaW5nKTogc3RyaW5nO1xufVxuXG5mdW5jdGlvbiBpc1RydXN0ZWRWYWx1ZSh2YWx1ZTogYW55KSB7XG4gIHJldHVybiB2YWx1ZS5lc2NhcGVkICE9PSB1bmRlZmluZWQgJiYgIXZhbHVlLmVzY2FwZWQ7XG59XG5cbmV4cG9ydCBjb25zdCBUSElTID0gMDtcblxuZXhwb3J0IGRlZmF1bHQgY2xhc3MgVGVtcGxhdGVDb21waWxlciB7XG4gIHN0YXRpYyBjb21waWxlKGFzdDogQVNULlByb2dyYW0sIG9wdGlvbnM/OiBDb21waWxlT3B0aW9ucyk6IFRlbXBsYXRlIHtcbiAgICBsZXQgdGVtcGxhdGVWaXNpdG9yID0gbmV3IFRlbXBsYXRlVmlzaXRvcigpO1xuICAgIHRlbXBsYXRlVmlzaXRvci52aXNpdChhc3QpO1xuXG4gICAgbGV0IGNvbXBpbGVyID0gbmV3IFRlbXBsYXRlQ29tcGlsZXIoKTtcbiAgICBsZXQgb3Bjb2RlczogU3ltYm9sSW5PcFtdID0gY29tcGlsZXIucHJvY2Vzcyh0ZW1wbGF0ZVZpc2l0b3IuYWN0aW9ucyk7XG4gICAgbGV0IHN5bWJvbHM6IFN5bWJvbE91dE9wW10gPSBuZXcgU3ltYm9sQWxsb2NhdG9yKG9wY29kZXMpLnByb2Nlc3MoKTtcblxuICAgIHJldHVybiBKYXZhU2NyaXB0Q29tcGlsZXIucHJvY2VzcyhzeW1ib2xzLCBhc3RbJ3N5bWJvbHMnXSwgb3B0aW9ucyk7XG4gIH1cblxuICBwcml2YXRlIHRlbXBsYXRlSWQgPSAwO1xuICBwcml2YXRlIHRlbXBsYXRlSWRzOiBudW1iZXJbXSA9IFtdO1xuICBwcml2YXRlIG9wY29kZXM6IFN5bWJvbEluT3BbXSA9IFtdO1xuICBwcml2YXRlIGluY2x1ZGVNZXRhID0gZmFsc2U7XG5cbiAgcHJvY2VzcyhhY3Rpb25zOiBBY3Rpb25bXSk6IFN5bWJvbEluT3BbXSB7XG4gICAgYWN0aW9ucy5mb3JFYWNoKChbbmFtZSwgLi4uYXJnc10pID0+IHtcbiAgICAgIGlmICghdGhpc1tuYW1lXSkge1xuICAgICAgICB0aHJvdyBuZXcgRXJyb3IoYFVuaW1wbGVtZW50ZWQgJHtuYW1lfSBvbiBUZW1wbGF0ZUNvbXBpbGVyYCk7XG4gICAgICB9XG4gICAgICAodGhpc1tuYW1lXSBhcyBhbnkpKC4uLmFyZ3MpO1xuICAgIH0pO1xuICAgIHJldHVybiB0aGlzLm9wY29kZXM7XG4gIH1cblxuICBzdGFydFByb2dyYW0oW3Byb2dyYW1dOiBbQVNULlByb2dyYW1dKSB7XG4gICAgdGhpcy5vcGNvZGUoWydzdGFydFByb2dyYW0nLCBwcm9ncmFtXSwgcHJvZ3JhbSk7XG4gIH1cblxuICBlbmRQcm9ncmFtKCkge1xuICAgIHRoaXMub3Bjb2RlKFsnZW5kUHJvZ3JhbScsIG51bGxdLCBudWxsKTtcbiAgfVxuXG4gIHN0YXJ0QmxvY2soW3Byb2dyYW1dOiBbQVNULlByb2dyYW1dKSB7XG4gICAgdGhpcy50ZW1wbGF0ZUlkKys7XG4gICAgdGhpcy5vcGNvZGUoWydzdGFydEJsb2NrJywgcHJvZ3JhbV0sIHByb2dyYW0pO1xuICB9XG5cbiAgZW5kQmxvY2soKSB7XG4gICAgdGhpcy50ZW1wbGF0ZUlkcy5wdXNoKHRoaXMudGVtcGxhdGVJZCAtIDEpO1xuICAgIHRoaXMub3Bjb2RlKFsnZW5kQmxvY2snLCBudWxsXSwgbnVsbCk7XG4gIH1cblxuICB0ZXh0KFthY3Rpb25dOiBbQVNULlRleHROb2RlXSkge1xuICAgIHRoaXMub3Bjb2RlKFsndGV4dCcsIGFjdGlvbi5jaGFyc10sIGFjdGlvbik7XG4gIH1cblxuICBjb21tZW50KFthY3Rpb25dOiBbQVNULkNvbW1lbnRTdGF0ZW1lbnRdKSB7XG4gICAgdGhpcy5vcGNvZGUoWydjb21tZW50JywgYWN0aW9uLnZhbHVlXSwgYWN0aW9uKTtcbiAgfVxuXG4gIG9wZW5FbGVtZW50KFthY3Rpb25dOiBbQVNULkVsZW1lbnROb2RlXSkge1xuICAgIGxldCBhdHRyaWJ1dGVzID0gYWN0aW9uLmF0dHJpYnV0ZXM7XG4gICAgbGV0IGhhc1NwbGF0ID0gZmFsc2U7XG5cbiAgICBmb3IgKGxldCBpID0gMDsgaSA8IGF0dHJpYnV0ZXMubGVuZ3RoOyBpKyspIHtcbiAgICAgIGxldCBhdHRyID0gYXR0cmlidXRlc1tpXTtcbiAgICAgIGlmIChhdHRyLm5hbWUgPT09ICcuLi5hdHRyaWJ1dGVzJykge1xuICAgICAgICBoYXNTcGxhdCA9IHRydWU7XG4gICAgICAgIGJyZWFrO1xuICAgICAgfVxuICAgIH1cblxuICAgIGxldCBhY3Rpb25Jc0NvbXBvbmVudCA9IGZhbHNlO1xuXG4gICAgaWYgKGlzRHluYW1pY0NvbXBvbmVudChhY3Rpb24pKSB7XG4gICAgICBsZXQgaGVhZDogUGF0aEhlYWQsIHJlc3Q6IHN0cmluZ1tdO1xuICAgICAgW2hlYWQsIC4uLnJlc3RdID0gYWN0aW9uLnRhZy5zcGxpdCgnLicpO1xuICAgICAgaWYgKGhlYWQgPT09ICd0aGlzJykge1xuICAgICAgICBoZWFkID0gMDtcbiAgICAgIH1cbiAgICAgIHRoaXMub3Bjb2RlKFsnZ2V0JywgW2hlYWQsIHJlc3RdXSk7XG4gICAgICB0aGlzLm9wY29kZShbJ29wZW5Db21wb25lbnQnLCBhY3Rpb25dLCBhY3Rpb24pO1xuICAgICAgYWN0aW9uSXNDb21wb25lbnQgPSB0cnVlO1xuICAgIH0gZWxzZSBpZiAoaXNDb21wb25lbnQoYWN0aW9uKSkge1xuICAgICAgdGhpcy5vcGNvZGUoWydvcGVuQ29tcG9uZW50JywgYWN0aW9uXSwgYWN0aW9uKTtcbiAgICAgIGFjdGlvbklzQ29tcG9uZW50ID0gdHJ1ZTtcbiAgICB9IGVsc2UgaWYgKGhhc1NwbGF0KSB7XG4gICAgICB0aGlzLm9wY29kZShbJ29wZW5TcGxhdHRlZEVsZW1lbnQnLCBhY3Rpb25dLCBhY3Rpb24pO1xuICAgIH0gZWxzZSB7XG4gICAgICB0aGlzLm9wY29kZShbJ29wZW5FbGVtZW50JywgYWN0aW9uXSwgYWN0aW9uKTtcbiAgICB9XG5cbiAgICBsZXQgdHlwZUF0dHI6IE9wdGlvbjxBU1QuQXR0ck5vZGU+ID0gbnVsbDtcbiAgICBsZXQgYXR0cnMgPSBhY3Rpb24uYXR0cmlidXRlcztcbiAgICBmb3IgKGxldCBpID0gMDsgaSA8IGF0dHJzLmxlbmd0aDsgaSsrKSB7XG4gICAgICBpZiAoYXR0cnNbaV0ubmFtZSA9PT0gJ3R5cGUnKSB7XG4gICAgICAgIHR5cGVBdHRyID0gYXR0cnNbaV07XG4gICAgICAgIGNvbnRpbnVlO1xuICAgICAgfVxuICAgICAgdGhpcy5hdHRyaWJ1dGUoW2F0dHJzW2ldXSwgaGFzU3BsYXQgfHwgYWN0aW9uSXNDb21wb25lbnQpO1xuICAgIH1cblxuICAgIGlmICh0eXBlQXR0cikge1xuICAgICAgdGhpcy5hdHRyaWJ1dGUoW3R5cGVBdHRyXSwgaGFzU3BsYXQgfHwgYWN0aW9uSXNDb21wb25lbnQpO1xuICAgIH1cblxuICAgIHRoaXMub3Bjb2RlKFsnZmx1c2hFbGVtZW50JywgYWN0aW9uXSwgbnVsbCk7XG4gIH1cblxuICBjbG9zZUVsZW1lbnQoW2FjdGlvbl06IFtBU1QuRWxlbWVudE5vZGVdKSB7XG4gICAgaWYgKGlzRHluYW1pY0NvbXBvbmVudChhY3Rpb24pKSB7XG4gICAgICB0aGlzLm9wY29kZShbJ2Nsb3NlRHluYW1pY0NvbXBvbmVudCcsIGFjdGlvbl0sIGFjdGlvbik7XG4gICAgfSBlbHNlIGlmIChpc0NvbXBvbmVudChhY3Rpb24pKSB7XG4gICAgICB0aGlzLm9wY29kZShbJ2Nsb3NlQ29tcG9uZW50JywgYWN0aW9uXSwgYWN0aW9uKTtcbiAgICB9IGVsc2UgaWYgKGFjdGlvbi5tb2RpZmllcnMubGVuZ3RoID4gMCkge1xuICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCBhY3Rpb24ubW9kaWZpZXJzLmxlbmd0aDsgaSsrKSB7XG4gICAgICAgIHRoaXMubW9kaWZpZXIoW2FjdGlvbi5tb2RpZmllcnNbaV1dKTtcbiAgICAgIH1cbiAgICAgIHRoaXMub3Bjb2RlKFsnY2xvc2VFbGVtZW50JywgYWN0aW9uXSwgYWN0aW9uKTtcbiAgICB9IGVsc2Uge1xuICAgICAgdGhpcy5vcGNvZGUoWydjbG9zZUVsZW1lbnQnLCBhY3Rpb25dLCBhY3Rpb24pO1xuICAgIH1cbiAgfVxuXG4gIGF0dHJpYnV0ZShbYWN0aW9uXTogW0FTVC5BdHRyTm9kZV0sIGlzQ29tcG9uZW50OiBib29sZWFuKSB7XG4gICAgbGV0IHsgbmFtZSwgdmFsdWUgfSA9IGFjdGlvbjtcblxuICAgIGxldCBuYW1lc3BhY2UgPSBnZXRBdHRyTmFtZXNwYWNlKG5hbWUpO1xuICAgIGxldCBpc1N0YXRpYyA9IHRoaXMucHJlcGFyZUF0dHJpYnV0ZVZhbHVlKHZhbHVlKTtcblxuICAgIGlmIChuYW1lLmNoYXJBdCgwKSA9PT0gJ0AnKSB7XG4gICAgICAvLyBBcmd1bWVudHNcbiAgICAgIGlmIChpc1N0YXRpYykge1xuICAgICAgICB0aGlzLm9wY29kZShbJ3N0YXRpY0FyZycsIG5hbWVdLCBhY3Rpb24pO1xuICAgICAgfSBlbHNlIGlmIChhY3Rpb24udmFsdWUudHlwZSA9PT0gJ011c3RhY2hlU3RhdGVtZW50Jykge1xuICAgICAgICB0aGlzLm9wY29kZShbJ2R5bmFtaWNBcmcnLCBuYW1lXSwgYWN0aW9uKTtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIHRoaXMub3Bjb2RlKFsnZHluYW1pY0FyZycsIG5hbWVdLCBhY3Rpb24pO1xuICAgICAgfVxuICAgIH0gZWxzZSB7XG4gICAgICBsZXQgaXNUcnVzdGluZyA9IGlzVHJ1c3RlZFZhbHVlKHZhbHVlKTtcblxuICAgICAgaWYgKGlzU3RhdGljICYmIG5hbWUgPT09ICcuLi5hdHRyaWJ1dGVzJykge1xuICAgICAgICB0aGlzLm9wY29kZShbJ2F0dHJTcGxhdCcsIG51bGxdLCBhY3Rpb24pO1xuICAgICAgfSBlbHNlIGlmIChpc1N0YXRpYyAmJiAhaXNDb21wb25lbnQpIHtcbiAgICAgICAgdGhpcy5vcGNvZGUoWydzdGF0aWNBdHRyJywgW25hbWUsIG5hbWVzcGFjZV1dLCBhY3Rpb24pO1xuICAgICAgfSBlbHNlIGlmIChpc1RydXN0aW5nKSB7XG4gICAgICAgIHRoaXMub3Bjb2RlKFxuICAgICAgICAgIFtpc0NvbXBvbmVudCA/ICd0cnVzdGluZ0NvbXBvbmVudEF0dHInIDogJ3RydXN0aW5nQXR0cicsIFtuYW1lLCBuYW1lc3BhY2VdXSxcbiAgICAgICAgICBhY3Rpb25cbiAgICAgICAgKTtcbiAgICAgIH0gZWxzZSBpZiAoYWN0aW9uLnZhbHVlLnR5cGUgPT09ICdNdXN0YWNoZVN0YXRlbWVudCcpIHtcbiAgICAgICAgdGhpcy5vcGNvZGUoW2lzQ29tcG9uZW50ID8gJ2NvbXBvbmVudEF0dHInIDogJ2R5bmFtaWNBdHRyJywgW25hbWUsIG51bGxdXSwgYWN0aW9uKTtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIHRoaXMub3Bjb2RlKFtpc0NvbXBvbmVudCA/ICdjb21wb25lbnRBdHRyJyA6ICdkeW5hbWljQXR0cicsIFtuYW1lLCBuYW1lc3BhY2VdXSwgYWN0aW9uKTtcbiAgICAgIH1cbiAgICB9XG4gIH1cblxuICBtb2RpZmllcihbYWN0aW9uXTogW0FTVC5FbGVtZW50TW9kaWZpZXJTdGF0ZW1lbnRdKSB7XG4gICAgYXNzZXJ0SXNTaW1wbGVQYXRoKGFjdGlvbi5wYXRoLCBhY3Rpb24ubG9jLCAnbW9kaWZpZXInKTtcblxuICAgIGxldCB7XG4gICAgICBwYXRoOiB7IHBhcnRzIH0sXG4gICAgfSA9IGFjdGlvbjtcblxuICAgIHRoaXMucHJlcGFyZUhlbHBlcihhY3Rpb24pO1xuICAgIHRoaXMub3Bjb2RlKFsnbW9kaWZpZXInLCBwYXJ0c1swXV0sIGFjdGlvbik7XG4gIH1cblxuICBtdXN0YWNoZShbYWN0aW9uXTogW0FTVC5NdXN0YWNoZVN0YXRlbWVudF0pIHtcbiAgICBsZXQgeyBwYXRoIH0gPSBhY3Rpb247XG5cbiAgICBpZiAoaXNMaXRlcmFsKHBhdGgpKSB7XG4gICAgICB0aGlzLm11c3RhY2hlRXhwcmVzc2lvbihhY3Rpb24pO1xuICAgICAgdGhpcy5vcGNvZGUoWydhcHBlbmQnLCAhYWN0aW9uLmVzY2FwZWRdLCBhY3Rpb24pO1xuICAgIH0gZWxzZSBpZiAoaXNZaWVsZChwYXRoKSkge1xuICAgICAgbGV0IHRvID0gYXNzZXJ0VmFsaWRZaWVsZChhY3Rpb24pO1xuICAgICAgdGhpcy55aWVsZCh0bywgYWN0aW9uKTtcbiAgICB9IGVsc2UgaWYgKGlzUGFydGlhbChwYXRoKSkge1xuICAgICAgbGV0IHBhcmFtcyA9IGFzc2VydFZhbGlkUGFydGlhbChhY3Rpb24pO1xuICAgICAgdGhpcy5wYXJ0aWFsKHBhcmFtcywgYWN0aW9uKTtcbiAgICB9IGVsc2UgaWYgKGlzRGVidWdnZXIocGF0aCkpIHtcbiAgICAgIGFzc2VydFZhbGlkRGVidWdnZXJVc2FnZShhY3Rpb24pO1xuICAgICAgdGhpcy5kZWJ1Z2dlcignZGVidWdnZXInLCBhY3Rpb24pO1xuICAgIH0gZWxzZSB7XG4gICAgICB0aGlzLm11c3RhY2hlRXhwcmVzc2lvbihhY3Rpb24pO1xuICAgICAgdGhpcy5vcGNvZGUoWydhcHBlbmQnLCAhYWN0aW9uLmVzY2FwZWRdLCBhY3Rpb24pO1xuICAgIH1cbiAgfVxuXG4gIGJsb2NrKFthY3Rpb24gLyosIGluZGV4LCBjb3VudCovXTogW0FTVC5CbG9ja1N0YXRlbWVudF0pIHtcbiAgICB0aGlzLnByZXBhcmVIZWxwZXIoYWN0aW9uKTtcbiAgICBsZXQgdGVtcGxhdGVJZCA9IHRoaXMudGVtcGxhdGVJZHMucG9wKCkhO1xuICAgIGxldCBpbnZlcnNlSWQgPSBhY3Rpb24uaW52ZXJzZSA9PT0gbnVsbCA/IG51bGwgOiB0aGlzLnRlbXBsYXRlSWRzLnBvcCgpITtcbiAgICB0aGlzLm9wY29kZShbJ2Jsb2NrJywgW2FjdGlvbi5wYXRoLnBhcnRzWzBdLCB0ZW1wbGF0ZUlkLCBpbnZlcnNlSWRdXSwgYWN0aW9uKTtcbiAgfVxuXG4gIC8vLyBJbnRlcm5hbCBhY3Rpb25zLCBub3QgZm91bmQgaW4gdGhlIG9yaWdpbmFsIHByb2Nlc3NlZCBhY3Rpb25zXG5cbiAgYXJnKFtwYXRoXTogW0FTVC5QYXRoRXhwcmVzc2lvbl0pIHtcbiAgICBsZXQge1xuICAgICAgcGFydHM6IFtoZWFkLCAuLi5yZXN0XSxcbiAgICB9ID0gcGF0aDtcbiAgICB0aGlzLm9wY29kZShbJ2dldCcsIFtgQCR7aGVhZH1gLCByZXN0XV0sIHBhdGgpO1xuICB9XG5cbiAgbXVzdGFjaGVFeHByZXNzaW9uKGV4cHI6IEFTVC5NdXN0YWNoZVN0YXRlbWVudCkge1xuICAgIGxldCB7IHBhdGggfSA9IGV4cHI7XG5cbiAgICBpZiAoaXNMaXRlcmFsKHBhdGgpKSB7XG4gICAgICB0aGlzLm9wY29kZShbJ2xpdGVyYWwnLCBwYXRoLnZhbHVlXSwgZXhwcik7XG4gICAgfSBlbHNlIGlmIChpc0J1aWx0SW5IZWxwZXIocGF0aCkpIHtcbiAgICAgIHRoaXMuYnVpbHRJbkhlbHBlcihleHByIGFzIEFTVC5DYWxsKTtcbiAgICB9IGVsc2UgaWYgKGlzQXJnKHBhdGgpKSB7XG4gICAgICB0aGlzLmFyZyhbcGF0aF0pO1xuICAgIH0gZWxzZSBpZiAoaXNIZWxwZXJJbnZvY2F0aW9uKGV4cHIpKSB7XG4gICAgICB0aGlzLnByZXBhcmVIZWxwZXIoZXhwcik7XG4gICAgICB0aGlzLm9wY29kZShbJ2hlbHBlcicsIHBhdGgucGFydHNbMF1dLCBleHByKTtcbiAgICB9IGVsc2UgaWYgKHBhdGgudGhpcykge1xuICAgICAgdGhpcy5vcGNvZGUoWydnZXQnLCBbMCwgcGF0aC5wYXJ0c11dLCBleHByKTtcbiAgICB9IGVsc2Uge1xuICAgICAgbGV0IFtoZWFkLCAuLi5wYXJ0c10gPSBwYXRoLnBhcnRzO1xuICAgICAgdGhpcy5vcGNvZGUoWydtYXliZUdldCcsIFtoZWFkLCBwYXJ0c11dLCBleHByKTtcbiAgICB9XG5cbiAgICAvLyB9IGVsc2UgaWYgKGlzTG9jYWwocGF0aCwgdGhpcy5zeW1ib2xzKSkge1xuICAgIC8vICAgbGV0IFtoZWFkLCAuLi5wYXJ0c10gPSBwYXRoLnBhcnRzO1xuICAgIC8vICAgdGhpcy5vcGNvZGUoWydnZXQnLCBbaGVhZCwgcGFydHNdXSwgZXhwcik7XG4gICAgLy8gfSBlbHNlIGlmIChpc1NpbXBsZVBhdGgocGF0aCkpIHtcbiAgICAvLyAgIHRoaXMub3Bjb2RlKFsndW5rbm93bicsIHBhdGgucGFydHNbMF1dLCBleHByKTtcbiAgICAvLyB9IGVsc2Uge1xuICAgIC8vICAgdGhpcy5vcGNvZGUoWydtYXliZUxvY2FsJywgcGF0aC5wYXJ0c10sIGV4cHIpO1xuICAgIC8vIH1cbiAgfVxuXG4gIC8vLyBJbnRlcm5hbCBTeW50YXhcblxuICB5aWVsZCh0bzogc3RyaW5nLCBhY3Rpb246IEFTVC5NdXN0YWNoZVN0YXRlbWVudCkge1xuICAgIHRoaXMucHJlcGFyZVBhcmFtcyhhY3Rpb24ucGFyYW1zKTtcbiAgICB0aGlzLm9wY29kZShbJ3lpZWxkJywgdG9dLCBhY3Rpb24pO1xuICB9XG5cbiAgZGVidWdnZXIoX25hbWU6IHN0cmluZywgYWN0aW9uOiBBU1QuTXVzdGFjaGVTdGF0ZW1lbnQpIHtcbiAgICB0aGlzLm9wY29kZShbJ2RlYnVnZ2VyJywgbnVsbF0sIGFjdGlvbik7XG4gIH1cblxuICBoYXNCbG9jayhuYW1lOiBzdHJpbmcsIGFjdGlvbjogQVNULkNhbGwpIHtcbiAgICB0aGlzLm9wY29kZShbJ2hhc0Jsb2NrJywgbmFtZV0sIGFjdGlvbik7XG4gIH1cblxuICBoYXNCbG9ja1BhcmFtcyhuYW1lOiBzdHJpbmcsIGFjdGlvbjogQVNULkNhbGwpIHtcbiAgICB0aGlzLm9wY29kZShbJ2hhc0Jsb2NrUGFyYW1zJywgbmFtZV0sIGFjdGlvbik7XG4gIH1cblxuICBwYXJ0aWFsKF9wYXJhbXM6IEFTVC5FeHByZXNzaW9uW10sIGFjdGlvbjogQVNULk11c3RhY2hlU3RhdGVtZW50KSB7XG4gICAgdGhpcy5wcmVwYXJlUGFyYW1zKGFjdGlvbi5wYXJhbXMpO1xuICAgIHRoaXMub3Bjb2RlKFsncGFydGlhbCcsIG51bGxdLCBhY3Rpb24pO1xuICB9XG5cbiAgYnVpbHRJbkhlbHBlcihleHByOiBBU1QuQ2FsbCkge1xuICAgIGxldCB7IHBhdGggfSA9IGV4cHI7XG4gICAgaWYgKGlzSGFzQmxvY2socGF0aCkpIHtcbiAgICAgIGxldCBuYW1lID0gYXNzZXJ0VmFsaWRIYXNCbG9ja1VzYWdlKGV4cHIucGF0aC5vcmlnaW5hbCwgZXhwcik7XG4gICAgICB0aGlzLmhhc0Jsb2NrKG5hbWUsIGV4cHIpO1xuICAgIH0gZWxzZSBpZiAoaXNIYXNCbG9ja1BhcmFtcyhwYXRoKSkge1xuICAgICAgbGV0IG5hbWUgPSBhc3NlcnRWYWxpZEhhc0Jsb2NrVXNhZ2UoZXhwci5wYXRoLm9yaWdpbmFsLCBleHByKTtcbiAgICAgIHRoaXMuaGFzQmxvY2tQYXJhbXMobmFtZSwgZXhwcik7XG4gICAgfVxuICB9XG5cbiAgLy8vIEV4cHJlc3Npb25zLCBpbnZva2VkIHJlY3Vyc2l2ZWx5IGZyb20gcHJlcGFyZVBhcmFtcyBhbmQgcHJlcGFyZUhhc2hcblxuICBTdWJFeHByZXNzaW9uKGV4cHI6IEFTVC5TdWJFeHByZXNzaW9uKSB7XG4gICAgaWYgKGlzQnVpbHRJbkhlbHBlcihleHByLnBhdGgpKSB7XG4gICAgICB0aGlzLmJ1aWx0SW5IZWxwZXIoZXhwcik7XG4gICAgfSBlbHNlIHtcbiAgICAgIHRoaXMucHJlcGFyZUhlbHBlcihleHByKTtcbiAgICAgIHRoaXMub3Bjb2RlKFsnaGVscGVyJywgZXhwci5wYXRoLnBhcnRzWzBdXSwgZXhwcik7XG4gICAgfVxuICB9XG5cbiAgUGF0aEV4cHJlc3Npb24oZXhwcjogQVNULlBhdGhFeHByZXNzaW9uKSB7XG4gICAgaWYgKGV4cHIuZGF0YSkge1xuICAgICAgdGhpcy5hcmcoW2V4cHJdKTtcbiAgICB9IGVsc2Uge1xuICAgICAgbGV0IFtoZWFkLCAuLi5yZXN0XSA9IGV4cHIucGFydHM7XG5cbiAgICAgIGlmIChleHByLnRoaXMpIHtcbiAgICAgICAgdGhpcy5vcGNvZGUoWydnZXQnLCBbMCwgZXhwci5wYXJ0c11dLCBleHByKTtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIHRoaXMub3Bjb2RlKFsnZ2V0JywgW2hlYWQsIHJlc3RdXSwgZXhwcik7XG4gICAgICB9XG4gICAgfVxuICB9XG5cbiAgU3RyaW5nTGl0ZXJhbChhY3Rpb246IEFTVC5TdHJpbmdMaXRlcmFsKSB7XG4gICAgdGhpcy5vcGNvZGUoWydsaXRlcmFsJywgYWN0aW9uLnZhbHVlXSwgYWN0aW9uKTtcbiAgfVxuXG4gIEJvb2xlYW5MaXRlcmFsKGFjdGlvbjogQVNULkJvb2xlYW5MaXRlcmFsKSB7XG4gICAgdGhpcy5vcGNvZGUoWydsaXRlcmFsJywgYWN0aW9uLnZhbHVlXSwgYWN0aW9uKTtcbiAgfVxuXG4gIE51bWJlckxpdGVyYWwoYWN0aW9uOiBBU1QuTnVtYmVyTGl0ZXJhbCkge1xuICAgIHRoaXMub3Bjb2RlKFsnbGl0ZXJhbCcsIGFjdGlvbi52YWx1ZV0sIGFjdGlvbik7XG4gIH1cblxuICBOdWxsTGl0ZXJhbChhY3Rpb246IEFTVC5OdWxsTGl0ZXJhbCkge1xuICAgIHRoaXMub3Bjb2RlKFsnbGl0ZXJhbCcsIGFjdGlvbi52YWx1ZV0sIGFjdGlvbik7XG4gIH1cblxuICBVbmRlZmluZWRMaXRlcmFsKGFjdGlvbjogQVNULlVuZGVmaW5lZExpdGVyYWwpIHtcbiAgICB0aGlzLm9wY29kZShbJ2xpdGVyYWwnLCBhY3Rpb24udmFsdWVdLCBhY3Rpb24pO1xuICB9XG5cbiAgLy8vIFV0aWxpdGllc1xuXG4gIG9wY29kZTxPIGV4dGVuZHMgU3ltYm9sSW5PcD4ob3Bjb2RlOiBPLCBhY3Rpb246IE9wdGlvbjxBU1QuQmFzZU5vZGU+ID0gbnVsbCkge1xuICAgIC8vIFRPRE86IFRoaXMgZG9lc24ndCByZWFsbHkgd29ya1xuICAgIGlmICh0aGlzLmluY2x1ZGVNZXRhICYmIGFjdGlvbikge1xuICAgICAgKG9wY29kZSBhcyBhbnkpLnB1c2godGhpcy5tZXRhKGFjdGlvbikpO1xuICAgIH1cblxuICAgIHRoaXMub3Bjb2Rlcy5wdXNoKG9wY29kZSk7XG4gIH1cblxuICBwcmVwYXJlSGVscGVyKGV4cHI6IEFTVC5DYWxsKSB7XG4gICAgYXNzZXJ0SXNTaW1wbGVQYXRoKGV4cHIucGF0aCwgZXhwci5sb2MsICdoZWxwZXInKTtcblxuICAgIGxldCB7IHBhcmFtcywgaGFzaCB9ID0gZXhwcjtcblxuICAgIHRoaXMucHJlcGFyZUhhc2goaGFzaCk7XG4gICAgdGhpcy5wcmVwYXJlUGFyYW1zKHBhcmFtcyk7XG4gIH1cblxuICBwcmVwYXJlUGFyYW1zKHBhcmFtczogQVNULkV4cHJlc3Npb25bXSkge1xuICAgIGlmICghcGFyYW1zLmxlbmd0aCkge1xuICAgICAgdGhpcy5vcGNvZGUoWydsaXRlcmFsJywgbnVsbF0sIG51bGwpO1xuICAgICAgcmV0dXJuO1xuICAgIH1cblxuICAgIGZvciAobGV0IGkgPSBwYXJhbXMubGVuZ3RoIC0gMTsgaSA+PSAwOyBpLS0pIHtcbiAgICAgIGxldCBwYXJhbSA9IHBhcmFtc1tpXTtcblxuICAgICAgYXNzZXJ0KHRoaXNbcGFyYW0udHlwZV0sIGBVbmltcGxlbWVudGVkICR7cGFyYW0udHlwZX0gb24gVGVtcGxhdGVDb21waWxlcmApO1xuICAgICAgKHRoaXNbcGFyYW0udHlwZV0gYXMgYW55KShwYXJhbSk7XG4gICAgfVxuXG4gICAgdGhpcy5vcGNvZGUoWydwcmVwYXJlQXJyYXknLCBwYXJhbXMubGVuZ3RoXSwgbnVsbCk7XG4gIH1cblxuICBwcmVwYXJlSGFzaChoYXNoOiBBU1QuSGFzaCkge1xuICAgIGxldCBwYWlycyA9IGhhc2gucGFpcnM7XG5cbiAgICBpZiAoIXBhaXJzLmxlbmd0aCkge1xuICAgICAgdGhpcy5vcGNvZGUoWydsaXRlcmFsJywgbnVsbF0sIG51bGwpO1xuICAgICAgcmV0dXJuO1xuICAgIH1cblxuICAgIGZvciAobGV0IGkgPSBwYWlycy5sZW5ndGggLSAxOyBpID49IDA7IGktLSkge1xuICAgICAgbGV0IHsga2V5LCB2YWx1ZSB9ID0gcGFpcnNbaV07XG5cbiAgICAgIGFzc2VydCh0aGlzW3ZhbHVlLnR5cGVdLCBgVW5pbXBsZW1lbnRlZCAke3ZhbHVlLnR5cGV9IG9uIFRlbXBsYXRlQ29tcGlsZXJgKTtcbiAgICAgICh0aGlzW3ZhbHVlLnR5cGVdIGFzIGFueSkodmFsdWUpO1xuICAgICAgdGhpcy5vcGNvZGUoWydsaXRlcmFsJywga2V5XSwgbnVsbCk7XG4gICAgfVxuXG4gICAgdGhpcy5vcGNvZGUoWydwcmVwYXJlT2JqZWN0JywgcGFpcnMubGVuZ3RoXSwgbnVsbCk7XG4gIH1cblxuICBwcmVwYXJlQXR0cmlidXRlVmFsdWUodmFsdWU6IEFTVC5BdHRyTm9kZVsndmFsdWUnXSkge1xuICAgIC8vIHJldHVybnMgdGhlIHN0YXRpYyB2YWx1ZSBpZiB0aGUgdmFsdWUgaXMgc3RhdGljXG5cbiAgICBzd2l0Y2ggKHZhbHVlLnR5cGUpIHtcbiAgICAgIGNhc2UgJ1RleHROb2RlJzpcbiAgICAgICAgdGhpcy5vcGNvZGUoWydsaXRlcmFsJywgdmFsdWUuY2hhcnNdLCB2YWx1ZSk7XG4gICAgICAgIHJldHVybiB0cnVlO1xuICAgICAgY2FzZSAnTXVzdGFjaGVTdGF0ZW1lbnQnOlxuICAgICAgICB0aGlzLmF0dHJpYnV0ZU11c3RhY2hlKFt2YWx1ZV0pO1xuICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICBjYXNlICdDb25jYXRTdGF0ZW1lbnQnOlxuICAgICAgICB0aGlzLnByZXBhcmVDb25jYXRQYXJ0cyh2YWx1ZS5wYXJ0cyk7XG4gICAgICAgIHRoaXMub3Bjb2RlKFsnY29uY2F0JywgbnVsbF0sIHZhbHVlKTtcbiAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgIH1cbiAgfVxuXG4gIHByZXBhcmVDb25jYXRQYXJ0cyhwYXJ0czogQVNULkNvbmNhdFN0YXRlbWVudFsncGFydHMnXSkge1xuICAgIGZvciAobGV0IGkgPSBwYXJ0cy5sZW5ndGggLSAxOyBpID49IDA7IGktLSkge1xuICAgICAgbGV0IHBhcnQgPSBwYXJ0c1tpXTtcblxuICAgICAgaWYgKHBhcnQudHlwZSA9PT0gJ011c3RhY2hlU3RhdGVtZW50Jykge1xuICAgICAgICB0aGlzLmF0dHJpYnV0ZU11c3RhY2hlKFtwYXJ0XSk7XG4gICAgICB9IGVsc2UgaWYgKHBhcnQudHlwZSA9PT0gJ1RleHROb2RlJykge1xuICAgICAgICB0aGlzLm9wY29kZShbJ2xpdGVyYWwnLCBwYXJ0LmNoYXJzXSwgbnVsbCk7XG4gICAgICB9XG4gICAgfVxuXG4gICAgdGhpcy5vcGNvZGUoWydwcmVwYXJlQXJyYXknLCBwYXJ0cy5sZW5ndGhdLCBudWxsKTtcbiAgfVxuXG4gIGF0dHJpYnV0ZU11c3RhY2hlKFthY3Rpb25dOiBbQVNULk11c3RhY2hlU3RhdGVtZW50XSkge1xuICAgIHRoaXMubXVzdGFjaGVFeHByZXNzaW9uKGFjdGlvbik7XG4gIH1cblxuICBtZXRhKG5vZGU6IEFTVC5CYXNlTm9kZSkge1xuICAgIGxldCBsb2MgPSBub2RlLmxvYztcbiAgICBpZiAoIWxvYykge1xuICAgICAgcmV0dXJuIFtdO1xuICAgIH1cblxuICAgIGxldCB7IHNvdXJjZSwgc3RhcnQsIGVuZCB9ID0gbG9jO1xuICAgIHJldHVybiBbJ2xvYycsIFtzb3VyY2UgfHwgbnVsbCwgW3N0YXJ0LmxpbmUsIHN0YXJ0LmNvbHVtbl0sIFtlbmQubGluZSwgZW5kLmNvbHVtbl1dXTtcbiAgfVxufVxuXG5mdW5jdGlvbiBpc0hlbHBlckludm9jYXRpb24oXG4gIG11c3RhY2hlOiBBU1QuTXVzdGFjaGVTdGF0ZW1lbnRcbik6IG11c3RhY2hlIGlzIEFTVC5NdXN0YWNoZVN0YXRlbWVudCAmIHsgcGF0aDogQVNULlBhdGhFeHByZXNzaW9uIH0ge1xuICByZXR1cm4gKFxuICAgIChtdXN0YWNoZS5wYXJhbXMgJiYgbXVzdGFjaGUucGFyYW1zLmxlbmd0aCA+IDApIHx8XG4gICAgKG11c3RhY2hlLmhhc2ggJiYgbXVzdGFjaGUuaGFzaC5wYWlycy5sZW5ndGggPiAwKVxuICApO1xufVxuXG5mdW5jdGlvbiBpc1NpbXBsZVBhdGgoeyBwYXJ0cyB9OiBBU1QuUGF0aEV4cHJlc3Npb24pOiBib29sZWFuIHtcbiAgcmV0dXJuIHBhcnRzLmxlbmd0aCA9PT0gMTtcbn1cblxuZnVuY3Rpb24gaXNZaWVsZChwYXRoOiBBU1QuUGF0aEV4cHJlc3Npb24pIHtcbiAgcmV0dXJuIHBhdGgub3JpZ2luYWwgPT09ICd5aWVsZCc7XG59XG5cbmZ1bmN0aW9uIGlzUGFydGlhbChwYXRoOiBBU1QuUGF0aEV4cHJlc3Npb24pIHtcbiAgcmV0dXJuIHBhdGgub3JpZ2luYWwgPT09ICdwYXJ0aWFsJztcbn1cblxuZnVuY3Rpb24gaXNEZWJ1Z2dlcihwYXRoOiBBU1QuUGF0aEV4cHJlc3Npb24pIHtcbiAgcmV0dXJuIHBhdGgub3JpZ2luYWwgPT09ICdkZWJ1Z2dlcic7XG59XG5cbmZ1bmN0aW9uIGlzSGFzQmxvY2socGF0aDogQVNULlBhdGhFeHByZXNzaW9uKSB7XG4gIHJldHVybiBwYXRoLm9yaWdpbmFsID09PSAnaGFzLWJsb2NrJztcbn1cblxuZnVuY3Rpb24gaXNIYXNCbG9ja1BhcmFtcyhwYXRoOiBBU1QuUGF0aEV4cHJlc3Npb24pIHtcbiAgcmV0dXJuIHBhdGgub3JpZ2luYWwgPT09ICdoYXMtYmxvY2stcGFyYW1zJztcbn1cblxuZnVuY3Rpb24gaXNCdWlsdEluSGVscGVyKHBhdGg6IEFTVC5QYXRoRXhwcmVzc2lvbikge1xuICByZXR1cm4gaXNIYXNCbG9jayhwYXRoKSB8fCBpc0hhc0Jsb2NrUGFyYW1zKHBhdGgpO1xufVxuXG5mdW5jdGlvbiBpc0FyZyhwYXRoOiBBU1QuUGF0aEV4cHJlc3Npb24pOiBib29sZWFuIHtcbiAgcmV0dXJuICEhcGF0aFsnZGF0YSddO1xufVxuXG5mdW5jdGlvbiBpc0R5bmFtaWNDb21wb25lbnQoZWxlbWVudDogQVNULkVsZW1lbnROb2RlKTogYm9vbGVhbiB7XG4gIGxldCBvcGVuID0gZWxlbWVudC50YWcuY2hhckF0KDApO1xuXG4gIGxldCBbbWF5YmVMb2NhbF0gPSBlbGVtZW50LnRhZy5zcGxpdCgnLicpO1xuICBsZXQgaXNOYW1lZEFyZ3VtZW50ID0gb3BlbiA9PT0gJ0AnO1xuICBsZXQgaXNMb2NhbCA9IGVsZW1lbnRbJ3N5bWJvbHMnXS5oYXMobWF5YmVMb2NhbCk7XG4gIGxldCBpc1RoaXNQYXRoID0gZWxlbWVudC50YWcuaW5kZXhPZigndGhpcy4nKSA9PT0gMDtcblxuICByZXR1cm4gaXNMb2NhbCB8fCBpc05hbWVkQXJndW1lbnQgfHwgaXNUaGlzUGF0aDtcbn1cblxuZnVuY3Rpb24gaXNDb21wb25lbnQoZWxlbWVudDogQVNULkVsZW1lbnROb2RlKTogYm9vbGVhbiB7XG4gIGxldCBvcGVuID0gZWxlbWVudC50YWcuY2hhckF0KDApO1xuICBsZXQgaXNQYXRoID0gZWxlbWVudC50YWcuaW5kZXhPZignLicpID4gLTE7XG5cbiAgbGV0IGlzVXBwZXJDYXNlID0gb3BlbiA9PT0gb3Blbi50b1VwcGVyQ2FzZSgpICYmIG9wZW4gIT09IG9wZW4udG9Mb3dlckNhc2UoKTtcblxuICByZXR1cm4gKGlzVXBwZXJDYXNlICYmICFpc1BhdGgpIHx8IGlzRHluYW1pY0NvbXBvbmVudChlbGVtZW50KTtcbn1cblxuZnVuY3Rpb24gYXNzZXJ0SXNTaW1wbGVQYXRoKHBhdGg6IEFTVC5QYXRoRXhwcmVzc2lvbiwgbG9jOiBBU1QuU291cmNlTG9jYXRpb24sIGNvbnRleHQ6IHN0cmluZykge1xuICBpZiAoIWlzU2ltcGxlUGF0aChwYXRoKSkge1xuICAgIHRocm93IG5ldyBTeW50YXhFcnJvcihcbiAgICAgIGBcXGAke3BhdGgub3JpZ2luYWx9XFxgIGlzIG5vdCBhIHZhbGlkIG5hbWUgZm9yIGEgJHtjb250ZXh0fSBvbiBsaW5lICR7bG9jLnN0YXJ0LmxpbmV9LmAsXG4gICAgICBwYXRoLmxvY1xuICAgICk7XG4gIH1cbn1cblxuZnVuY3Rpb24gYXNzZXJ0VmFsaWRZaWVsZChzdGF0ZW1lbnQ6IEFTVC5NdXN0YWNoZVN0YXRlbWVudCk6IHN0cmluZyB7XG4gIGxldCB7IHBhaXJzIH0gPSBzdGF0ZW1lbnQuaGFzaDtcblxuICBpZiAoKHBhaXJzLmxlbmd0aCA9PT0gMSAmJiBwYWlyc1swXS5rZXkgIT09ICd0bycpIHx8IHBhaXJzLmxlbmd0aCA+IDEpIHtcbiAgICB0aHJvdyBuZXcgU3ludGF4RXJyb3IoYHlpZWxkIG9ubHkgdGFrZXMgYSBzaW5nbGUgbmFtZWQgYXJndW1lbnQ6ICd0bydgLCBzdGF0ZW1lbnQubG9jKTtcbiAgfSBlbHNlIGlmIChwYWlycy5sZW5ndGggPT09IDEgJiYgcGFpcnNbMF0udmFsdWUudHlwZSAhPT0gJ1N0cmluZ0xpdGVyYWwnKSB7XG4gICAgdGhyb3cgbmV3IFN5bnRheEVycm9yKGB5b3UgY2FuIG9ubHkgeWllbGQgdG8gYSBsaXRlcmFsIHZhbHVlYCwgc3RhdGVtZW50LmxvYyk7XG4gIH0gZWxzZSBpZiAocGFpcnMubGVuZ3RoID09PSAwKSB7XG4gICAgcmV0dXJuICdkZWZhdWx0JztcbiAgfSBlbHNlIHtcbiAgICByZXR1cm4gKHBhaXJzWzBdLnZhbHVlIGFzIEFTVC5TdHJpbmdMaXRlcmFsKS52YWx1ZTtcbiAgfVxufVxuXG5mdW5jdGlvbiBhc3NlcnRWYWxpZFBhcnRpYWwoc3RhdGVtZW50OiBBU1QuTXVzdGFjaGVTdGF0ZW1lbnQpIC8qIDogZXhwciAqLyB7XG4gIGxldCB7IHBhcmFtcywgaGFzaCwgZXNjYXBlZCwgbG9jIH0gPSBzdGF0ZW1lbnQ7XG5cbiAgaWYgKHBhcmFtcyAmJiBwYXJhbXMubGVuZ3RoICE9PSAxKSB7XG4gICAgdGhyb3cgbmV3IFN5bnRheEVycm9yKFxuICAgICAgYFBhcnRpYWwgZm91bmQgd2l0aCBubyBhcmd1bWVudHMuIFlvdSBtdXN0IHNwZWNpZnkgYSB0ZW1wbGF0ZSBuYW1lLiAob24gbGluZSAke1xuICAgICAgICBsb2Muc3RhcnQubGluZVxuICAgICAgfSlgLFxuICAgICAgc3RhdGVtZW50LmxvY1xuICAgICk7XG4gIH0gZWxzZSBpZiAoaGFzaCAmJiBoYXNoLnBhaXJzLmxlbmd0aCA+IDApIHtcbiAgICB0aHJvdyBuZXcgU3ludGF4RXJyb3IoXG4gICAgICBgcGFydGlhbCBkb2VzIG5vdCB0YWtlIGFueSBuYW1lZCBhcmd1bWVudHMgKG9uIGxpbmUgJHtsb2Muc3RhcnQubGluZX0pYCxcbiAgICAgIHN0YXRlbWVudC5sb2NcbiAgICApO1xuICB9IGVsc2UgaWYgKCFlc2NhcGVkKSB7XG4gICAgdGhyb3cgbmV3IFN5bnRheEVycm9yKFxuICAgICAgYHt7e3BhcnRpYWwgLi4ufX19IGlzIG5vdCBzdXBwb3J0ZWQsIHBsZWFzZSB1c2Uge3twYXJ0aWFsIC4uLn19IGluc3RlYWQgKG9uIGxpbmUgJHtcbiAgICAgICAgbG9jLnN0YXJ0LmxpbmVcbiAgICAgIH0pYCxcbiAgICAgIHN0YXRlbWVudC5sb2NcbiAgICApO1xuICB9XG5cbiAgcmV0dXJuIHBhcmFtcztcbn1cblxuZnVuY3Rpb24gYXNzZXJ0VmFsaWRIYXNCbG9ja1VzYWdlKHR5cGU6IHN0cmluZywgY2FsbDogQVNULkNhbGwpOiBzdHJpbmcge1xuICBsZXQgeyBwYXJhbXMsIGhhc2gsIGxvYyB9ID0gY2FsbDtcblxuICBpZiAoaGFzaCAmJiBoYXNoLnBhaXJzLmxlbmd0aCA+IDApIHtcbiAgICB0aHJvdyBuZXcgU3ludGF4RXJyb3IoYCR7dHlwZX0gZG9lcyBub3QgdGFrZSBhbnkgbmFtZWQgYXJndW1lbnRzYCwgY2FsbC5sb2MpO1xuICB9XG5cbiAgaWYgKHBhcmFtcy5sZW5ndGggPT09IDApIHtcbiAgICByZXR1cm4gJ2RlZmF1bHQnO1xuICB9IGVsc2UgaWYgKHBhcmFtcy5sZW5ndGggPT09IDEpIHtcbiAgICBsZXQgcGFyYW0gPSBwYXJhbXNbMF07XG4gICAgaWYgKHBhcmFtLnR5cGUgPT09ICdTdHJpbmdMaXRlcmFsJykge1xuICAgICAgcmV0dXJuIHBhcmFtLnZhbHVlO1xuICAgIH0gZWxzZSB7XG4gICAgICB0aHJvdyBuZXcgU3ludGF4RXJyb3IoXG4gICAgICAgIGB5b3UgY2FuIG9ubHkgeWllbGQgdG8gYSBsaXRlcmFsIHZhbHVlIChvbiBsaW5lICR7bG9jLnN0YXJ0LmxpbmV9KWAsXG4gICAgICAgIGNhbGwubG9jXG4gICAgICApO1xuICAgIH1cbiAgfSBlbHNlIHtcbiAgICB0aHJvdyBuZXcgU3ludGF4RXJyb3IoXG4gICAgICBgJHt0eXBlfSBvbmx5IHRha2VzIGEgc2luZ2xlIHBvc2l0aW9uYWwgYXJndW1lbnQgKG9uIGxpbmUgJHtsb2Muc3RhcnQubGluZX0pYCxcbiAgICAgIGNhbGwubG9jXG4gICAgKTtcbiAgfVxufVxuXG5mdW5jdGlvbiBhc3NlcnRWYWxpZERlYnVnZ2VyVXNhZ2Uoc3RhdGVtZW50OiBBU1QuTXVzdGFjaGVTdGF0ZW1lbnQpIHtcbiAgbGV0IHsgcGFyYW1zLCBoYXNoIH0gPSBzdGF0ZW1lbnQ7XG5cbiAgaWYgKGhhc2ggJiYgaGFzaC5wYWlycy5sZW5ndGggPiAwKSB7XG4gICAgdGhyb3cgbmV3IFN5bnRheEVycm9yKGBkZWJ1Z2dlciBkb2VzIG5vdCB0YWtlIGFueSBuYW1lZCBhcmd1bWVudHNgLCBzdGF0ZW1lbnQubG9jKTtcbiAgfVxuXG4gIGlmIChwYXJhbXMubGVuZ3RoID09PSAwKSB7XG4gICAgcmV0dXJuICdkZWZhdWx0JztcbiAgfSBlbHNlIHtcbiAgICB0aHJvdyBuZXcgU3ludGF4RXJyb3IoYGRlYnVnZ2VyIGRvZXMgbm90IHRha2UgYW55IHBvc2l0aW9uYWwgYXJndW1lbnRzYCwgc3RhdGVtZW50LmxvYyk7XG4gIH1cbn1cbiJdfQ==